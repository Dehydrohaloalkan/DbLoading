# 5. Frontend (Angular 21 + PrimeNG 21) — дизайн

## 5.1. Технологии

- Angular 21
- PrimeNG 21
- Подход к стилю: аккуратный “Material‑like” UI, карточки, ровные отступы, нейтральная цветовая схема.

## 5.2. Основные экраны

### Экран 1: Login

Карточка логина с 5 полями:

1. DB username (text)
2. DB password (password)
3. DB (dropdown)
4. Manager (dropdown)
5. Stream (dropdown)

Поведение:

- Валидация required.
- Пока идёт логин — disable кнопки и поля, показать loader.
- Ошибка логина (не удалось подключиться к DB2) — показать сообщение и оставить форму заполненной (кроме пароля — по желанию).

### Экран 2: Main

#### Top bar

- Слева: **DbLoading**
- Справа: `login | manager | stream | database` + кнопка “Выйти”

#### Основная область (2 колонки)

**Левая колонка**

- Tabs по группам (PrimeNG TabView).
- Внутри вкладки:
  - список логических скриптов с чекбоксами “включить в запуск”
  - сводная индикация статуса по каждому скрипту (иконка + текст)
- Кнопки:
  - “Запустить группу”
  - На отдельной панели/в шапке: “Запустить все группы”

Важно: пользователь не запускает отдельный скрипт “в один клик”, но может включать/исключать его из запуска группы.

**Правая колонка**

- Панель настроек для выбранного логического скрипта:
  - режим:
    - Default (LineFile)
    - Custom columns
  - при Custom:
    - multi‑select со списком доступных выражений/колонок (из конфига)
    - поиск/фильтрация
    - описание/tooltip (если задано в конфиге)

## 5.3. Индикация статусов

Рекомендуемая визуализация (PrimeNG icons):

- `Queued`: часы / серый
- `Running`: spinner / синий
- `Success`: check / зелёный
- `NoData`: info / нейтральный
- `Failed`: times / красный
- `Cancelled`: ban / оранжевый

Дополнительно:

- “Последнее событие/время” под статусом.
- Варианты скрыты от пользователя, но при ошибке можно показывать “Variant 2 failed” в деталях/логах.

## 5.4. Синхронизация с сервером

- После логина клиент подключается к SignalR hub и подписывается на `runId` события.
- Для первичной загрузки состояния клиент делает REST запрос “current runs/status” (на случай переподключений), затем слушает realtime‑обновления.

## 5.5. Хранение токенов и безопасность на клиенте

### Библиотека аутентификации (web/src/lib/auth)

Вынесена в отдельную библиотеку с минимальными зависимостями:

- `AuthLibService` — основной сервис аутентификации
- `authLibInterceptor` — HTTP interceptor для токенов
- `authLibGuard` — guard для защищённых маршрутов

### Подключение

```typescript
// app.config.ts
import { AuthLibService } from '../lib/auth';

export const appConfig: ApplicationConfig = {
  providers: [
    AuthLibService,
    {
      provide: APP_INITIALIZER,
      useFactory: (authLib: AuthLibService) => () => {
        authLib.configure({ apiUrl: 'http://localhost:5068/api/auth' });
      },
      deps: [AuthLibService],
      multi: true
    }
  ]
};
```

### Хранение токенов

- Refresh token хранится только в **HttpOnly cookie** (клиент его не читает).
- Access token:
  - хранить в памяти приложения (service)
  - добавлять в Authorization header через interceptor
- При 401:
  - выполнить refresh (REST), затем повторить запрос

Подробно — `08-security-auth.md`.

## 5.6. Генерация проекта через CLI (требование)

Рекомендации:

- создавать приложение `ng new ...` и компоненты/модули/сервисы через Angular CLI
- PrimeNG добавлять через официальные гайды (версии 21)
- внимательно выбирать рабочую папку при запуске CLI (в корне репозитория будет и backend, и frontend)

